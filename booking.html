<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fixt. - Réservation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      input[type="date"] {
        color-scheme: dark;
      }
    </style>
  </head>
  <body
    class="flex flex-col min-h-screen bg-[#F8FAFC] font-sans text-slate-800"
  >
    <nav
      class="w-full py-6 px-8 flex justify-between items-center max-w-7xl mx-auto"
    >
      <a href="index.html"
        ><img
          src="img/logo.png"
          alt="Fixt Logo"
          class="h-20 w-auto object-contain"
      /></a>
      <a href="index.html" class="text-slate-500 font-bold text-sm">Retour</a>
    </nav>

    <main
      id="booking-page"
      class="flex-grow flex items-center justify-center p-4 lg:p-8 mb-12"
    >
      <div
        class="max-w-6xl w-full bg-white rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col lg:flex-row min-h-[700px] border border-slate-100"
      >
        <div
          class="lg:w-2/5 bg-[#002050] p-8 md:p-12 text-white flex flex-col relative overflow-hidden"
        >
          <h1 class="text-3xl font-extrabold mb-10">
            Votre installation<br /><span class="text-[#5475FF]"
              >commence ici.</span
            >
          </h1>

          <div id="service-step" class="mb-6">
            <label class="text-xs font-bold uppercase text-blue-300 mb-2 block"
              >1. Choisissez la prestation</label
            >
            <div id="service-selector-container" class="space-y-2"></div>
          </div>

          <div
            id="date-step"
            class="opacity-50 pointer-events-none mb-6 transition-all"
          >
            <label class="text-xs font-bold uppercase text-blue-300 mb-2 block"
              >2. Date d'intervention</label
            >
            <input
              type="date"
              id="date-picker"
              onchange="onDateChanged()"
              class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white outline-none focus:border-[#5475FF] cursor-pointer"
            />
          </div>

          <div
            id="slots-step"
            class="flex-1 flex flex-col opacity-50 pointer-events-none transition-all"
          >
            <label class="text-xs font-bold uppercase text-blue-300 mb-2 block"
              >3. Heure</label
            >
            <div id="slots-loader" class="hidden text-sm text-blue-300">
              Recherche...
            </div>
            <div
              id="slots-container"
              class="grid grid-cols-3 gap-2 overflow-y-auto no-scrollbar pr-2 content-start h-32"
            >
              <div class="col-span-3 text-sm text-blue-300/50 italic">
                En attente d'une date...
              </div>
            </div>
          </div>
        </div>

        <div class="lg:w-3/5 p-8 md:p-14 bg-white flex flex-col justify-center">
          <h2 class="text-3xl font-extrabold text-[#002050] mb-2">
            Finalisation
          </h2>
          <p class="text-slate-500 mb-8">Vos coordonnées pour le RDV.</p>

          <form
            id="booking-form"
            onsubmit="handlePayment(event)"
            class="space-y-5"
          >
            <div
              class="bg-slate-50 border border-slate-100 rounded-2xl p-5 flex items-center gap-5"
            >
              <div class="flex-1">
                <div
                  class="font-bold text-[#002050] text-lg"
                  id="summary-service"
                >
                  Sélectionnez un service
                </div>
                <div class="text-sm text-[#5475FF] font-medium">
                  <span id="summary-date">...</span>
                  <span id="summary-time"></span>
                </div>
              </div>
              <div
                class="text-2xl font-extrabold text-[#002050]"
                id="total-price-display"
              >
                0€
              </div>
            </div>

            <input type="hidden" id="final-service-id" />
            <input type="hidden" id="final-date" />
            <input type="hidden" id="final-time" />
            <input type="hidden" id="final-price" />

            <div class="space-y-3">
              <label class="text-xs font-bold uppercase text-slate-400 ml-1"
                >Vos coordonnées</label
              >
              <div class="grid grid-cols-2 gap-4">
                <input
                  type="text"
                  id="prenom"
                  placeholder="Prénom"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
                <input
                  type="text"
                  id="nom"
                  placeholder="Nom"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input
                  type="email"
                  id="email"
                  placeholder="Email"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
                <input
                  type="tel"
                  id="tel"
                  placeholder="Téléphone"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
              </div>
            </div>

            <div class="space-y-3">
              <label class="text-xs font-bold uppercase text-slate-400 ml-1"
                >Lieu d'intervention</label
              >
              <input
                type="text"
                id="address"
                placeholder="Adresse complète (Rue, Ville, Code Postal)"
                required
                class="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
              />
            </div>

            <div class="space-y-3">
              <label class="text-xs font-bold uppercase text-slate-400 ml-1"
                >Votre Véhicule</label
              >
              <div class="grid grid-cols-3 gap-3">
                <input
                  type="text"
                  id="car-make"
                  placeholder="Marque (ex: Audi)"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
                <input
                  type="text"
                  id="car-model"
                  placeholder="Modèle (ex: A3)"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
                <input
                  type="number"
                  id="car-year"
                  placeholder="Année"
                  required
                  class="bg-slate-50 border border-slate-200 rounded-xl p-4 outline-none focus:border-[#5475FF]"
                />
              </div>
            </div>

            <button
              type="submit"
              id="pay-btn"
              disabled
              class="w-full bg-[#5475FF] hover:bg-[#3b5bdb] text-white py-5 rounded-2xl font-bold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all mt-4"
            >
              Confirmer le rendez-vous
            </button>
          </form>
        </div>
      </div>
    </main>

    <div
      id="toast-container"
      class="fixed bottom-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none"
    ></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
  </body>
</html>
